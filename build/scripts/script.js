var pomodoro={kitchenTimer:document.createElement("audio"),breakSound:document.createElement("audio"),initMin:1,min:1,sec:0,timerInterval:"",breakLength:5,sessions:3,state:"stopped",i:1,init:function(){this.cacheDom(),this.loadSounds(),this.bindEvents(),this.render(this.min,this.sec),this.checkMode()},cacheDom:function(){this.$el=$("#pomodoro"),this.$timer=this.$el.children("p:eq(1)"),this.$breakText=this.$el.children("p:eq(0)"),this.$start=$("#start"),this.$pause=$("#pause"),this.$subtract=$("#subtract"),this.$add=$("#add"),this.$reset=$("#reset")},bindEvents:function(){this.$start.on("click",this.startTimer.bind(this)).on("click",this.checkSettings.bind(this)),this.$pause.on("click",this.pauseTimer.bind(this)),this.$subtract.on("click",this.subtractTime.bind(this)),this.$add.on("click",this.addTime.bind(this)),this.$reset.on("click",this.resetTimer.bind(this))},render:function(t,i){this.$timer.text(this.pad(t,2)+":"+this.pad(i,2))},loadSounds:function(){this.kitchenTimer.src="assets/sounds/kitchen-timer.mp3",this.kitchenTimer.load(),this.breakSound.src="assets/sounds/rossini-la-gazza-ladra-cut.mp3",this.breakSound.load()},checkMode:function(){("work"===this.$el.prop("mode")||"paused"===this.$el.prop("mode"))&&(this.$pause.prop("disabled",!1),this.$el.find("button").not(this.$pause).not(this.$reset).prop("disabled",!0)),"stopped"===this.$el.prop("mode")&&(this.$el.find("button").prop("disabled",!1),this.$pause.prop("disabled",!0))},pad:function(t,i){return t=t.toString(),t.length<i?this.pad("0"+t,i):t},startTimer:function(){this.state="running",this.$el.prop("mode","work"),this.checkMode(),this.countDown(),this.timerInterval=setInterval(this.countDown.bind(this),10)},checkSettings:function(){this.breakLength=settings.breakLength,this.sessions=settings.sessions},pauseTimer:function(){"paused"!==this.$el.prop("mode")?(this.$el.prop("mode","paused"),this.$pause.find("i").removeClass("fa-pause").addClass("fa-play"),clearInterval(this.timerInterval)):(this.i%2!==0?this.$el.prop("mode","work"):this.i%2===0&&this.$el.prop("mode","break"),this.$pause.find("i").removeClass("fa-play").addClass("fa-pause"),this.timerInterval=setInterval(this.countDown.bind(this),100))},subtractTime:function(){this.min--,this.initMin--,this.min<1&&(this.min=1),this.render(this.min,this.sec)},addTime:function(){this.min++,this.initMin++,this.render(this.min,this.sec)},resetTimer:function(){this.state="stopped",this.$el.prop("mode","stopped"),this.checkMode(),this.$pause.find("i").removeClass("fa-play").addClass("fa-pause"),this.$breakText.css("visibility","hidden"),this.$timer.removeClass("gray"),clearInterval(this.timerInterval),this.min=this.initMin,this.sec=0,this.render(this.min,this.sec)},countDown:function(){0===this.min&&0===this.sec&&(this.i++,this.counterZero()),-1===this.sec&&(this.sec=59,this.min--),this.render(this.min,this.sec),this.sec--},counterZero:function(){if(clearInterval(this.timerInterval),this.sessions>=0&&"work"===this.$el.prop("mode"))this.breakSound.play(),this.$breakText.css("visibility","initial"),this.$timer.addClass("gray"),this.sessions--,this.$el.prop("mode","break"),this.min=this.breakLength,this.timerInterval=setInterval(this.countDown.bind(this),100);else{if(!(this.sessions>0&&"break"===this.$el.prop("mode")))return this.breakSound.play(),this.$breakText.css("visibility","hidden"),void this.$timer.removeClass("gray");this.kitchenTimer.play(),this.$breakText.css("visibility","hidden"),this.$timer.removeClass("gray"),this.$el.prop("mode","work"),this.min=this.initMin,this.timerInterval=setInterval(this.countDown.bind(this),100)}}},settings={breakLength:5,sessions:3,init:function(){this.cacheDom(),this.bindEvents(),this.render()},cacheDom:function(){this.$el=$("#settings"),this.$toggleButton=this.$el.children("span"),this.$breakContainter=this.$el.find("span:eq(0)"),this.$sessionContainer=this.$el.find("span:eq(1)"),this.$minus=this.$el.find(".fa-minus"),this.$plus=this.$el.find(".fa-plus")},bindEvents:function(){this.$toggleButton.on("click",this.toggle.bind(this)),this.$minus.on("click",this.subtract.bind(this)),this.$plus.on("click",this.add.bind(this)),$("#pomodoro").on("click",function(){settings.$el.removeClass("open")})},render:function(){0===this.breakLength&&(this.breakLength=1),0===this.sessions&&(this.sessions=1),this.$breakContainter.text(this.breakLength),this.$sessionContainer.text(this.sessions)},toggle:function(){"stopped"===pomodoro.state&&this.$el.toggleClass("open")},subtract:function(t){var i=$(t.target).closest("div");i.hasClass("break-duration")?this.breakLength--:this.sessions--,this.render()},add:function(t){var i=$(t.target).closest("div");i.hasClass("break-duration")?this.breakLength++:this.sessions++,this.render()}};settings.init(),pomodoro.init();